#+TITLE: sync_bidireccional.sh
#+AUTHOR: Tu Nombre
#+DATE: 2025-09-05
#+DESCRIPTION: Sincronización bidireccional entre directorio local y pCloud

* Descripción
Script de sincronización bidireccional entre un directorio local (normalmente $HOME) y un directorio de pCloud. Permite subir, bajar, simular operaciones, manejar enlaces simbólicos y aplicar reglas de exclusión.

* Características
- Sincronización bidireccional (local ↔ pCloud)
- Modo dry-run (simulación)
- Eliminación de archivos obsoletos (--delete)
- Manejo de enlaces simbólicos
- Compatibilidad con backup de solo lectura
- Logging detallado
- Ajuste de permisos ejecutables
- Comparación opcional con checksum

* Requisitos
- bash >= 4.0
- rsync
- curl (opcional para verificación de conectividad)
- find, readlink, mktemp, stat
- pCloud Drive montado

* Configuración
- `PCLOUD_MOUNT_POINT`: punto de montaje de pCloud
- `LOCAL_DIR`: directorio local a sincronizar
- `PCLOUD_BACKUP_COMUN`: ruta de backup común en pCloud
- `PCLOUD_BACKUP_READONLY`: ruta de backup readonly
- `LISTA_SINCRONIZACION`: archivo INI con rutas a sincronizar
- `EXCLUSIONES`: archivo INI con rutas a excluir

* Opciones de línea de comando
** Modos principales (obligatorio)
- `--subir`      : sincroniza desde local → pCloud
- `--bajar`      : sincroniza desde pCloud → local

** Opciones secundarias
- `--delete`     : elimina archivos en destino que no existen en origen
- `--dry-run`    : simula la operación
- `--item ELEMENTO`: sincroniza solo el elemento indicado
- `--yes`        : no pide confirmación
- `--backup-dir` : usa backup de solo lectura
- `--overwrite`  : sobrescribe archivos existentes
- `--checksum`   : fuerza comparación con checksum
- `-h, --help`   : muestra ayuda

* Ejemplos de uso
- Subir todo:
  #+BEGIN_SRC sh
  ./sync_bidireccional.sh --subir
  #+END_SRC

- Bajar todo en modo simulación:
  #+BEGIN_SRC sh
  ./sync_bidireccional.sh --bajar --dry-run
  #+END_SRC

- Subir solo un directorio específico y eliminar archivos obsoletos:
  #+BEGIN_SRC sh
  ./sync_bidireccional.sh --subir --item documentos/ --delete --yes
  #+END_SRC

- Sincronizar con backup de solo lectura:
  #+BEGIN_SRC sh
  ./sync_bidireccional.sh --bajar --backup-dir --yes
  #+END_SRC

* Archivos de configuración
- Lista de directorios:
  - `sync_bidireccional_directorios.ini`
  - `sync_bidireccional_directorios_<hostname>.ini`
- Exclusiones:
  - `sync_bidireccional_exclusiones.ini`

* Logging
- Archivo: `~/sync_bidireccional.log`
- Contiene información de:
  - Inicio y fin de sincronización
  - Archivos transferidos, creados, actualizados, borrados
  - Enlaces simbólicos detectados, creados, existentes, errores
  - Comandos `rsync` ejecutados

